<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge System</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Vis.js Network CDN -->
    <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <!-- Lunr.js CDN -->
    <script src="https://unpkg.com/lunr/lunr.min.js"></script>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <header class="sidebar-header">
                <h1>Knowledge System</h1>
            </header>
            <section id="vault-controls" class="sidebar-section">
                <h2>Vault Configuration</h2>
                <label for="vault-path-input">Vault Path:</label>
                <input type="text" id="vault-path-input" placeholder="/path/to/your/notes_folder">
                <button id="set-vault-path-button">Set Vault</button>
                <p id="vault-status" class="status-text"></p>
            </section>

            <section id="search-section" class="sidebar-section">
                <h2>Search Notes</h2>
                <input type="search" id="search-input" placeholder="Search all notes...">
                <div id="search-results-container" style="display: none;">
                    <div class="search-controls">
                        <h4>Search Results:</h4>
                        <select id="search-sort-select">
                            <option value="relevance">Sort by Relevance</option>
                            <option value="date_desc">Date (Newest First)</option>
                            <option value="date_asc">Date (Oldest First)</option>
                        </select>
                    </div>
                    <ul id="search-results-list"></ul>
                    <p id="search-results-status" class="status-text"></p>
                </div>
            </section>

            <section id="gdrive-section" class="sidebar-section">
                <h2>Google Drive</h2>
                <div id="gdrive-auth-status">
                    <p>Status: Checking...</p>
                </div>
                <button id="gdrive-connect-button" style="display: none;">Connect to Google Drive</button>
                <div id="gdrive-files-container" style="display: none;">
                    <h3>Drive Files</h3>
                    <ul id="gdrive-files-list">
                        <!-- Google Drive files will be listed here -->
                    </ul>
                    <p id="gdrive-files-status" class="status-text"></p>
                </div>
            </section>

            <section id="notes-list-container" class="sidebar-section">
                <div class="sidebar-section-header">
                    <h2>Local Notes</h2>
                    <button id="create-new-note-button" title="Create New Note">+</button>
                </div>
                <ul id="notes-list">
                    <!-- Note items will be populated here -->
                </ul>
                <p id="notes-list-status" class="status-text">Set vault path to see notes.</p>
            </section>
        </aside>

        <main class="main-content">
            <section id="note-view-container">
                <div class="note-header">
                    <h2 id="current-note-title">Note View</h2>
                <button id="save-note-button">Save Note</button>
            </div>
            <p id="save-status" class="status-text"></p> {/* Changed class here */}

            <div id="note-metadata-display" style="display: none;">
                {/* Parsed frontmatter will be displayed here */}
            </div>

            {/* This div will be hidden, replaced by the textarea for editing */}
            <div id="note-content-display" class="note-content-area" style="display: none;">
                <p>Select a note to view its content.</p>
            </div>

            <div class="editor-preview-layout">
                <div class="editor-pane">
                    <h3>Markdown Editor</h3>
                    <textarea id="note-content-edit" class="note-content-area"></textarea>
                </div>
                <div class="preview-pane">
                    <h3>HTML Preview</h3>
                    <div id="note-content-preview" class="note-content-area">
                        <p>Preview will appear here.</p>
                    </div>
                </div>
            </div>

            <div id="graph-view-section" style="display: none;">
                <h3>Graph Visualization</h3>
                <div id="graph-container" style="height: 500px; border: 1px solid #ddd; background-color: #f9f9f9;">
                    <!-- Vis.js graph will be rendered here -->
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>Status: <span id="backend-status">Connecting to backend...</span></p>
    </footer>

    <script src="script.js"></script>
</body>
</html>
